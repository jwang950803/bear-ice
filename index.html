<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç†Šå†°O - å˜‰ç¾©ä¸­åŸ”å†·å‡é£Ÿå“æ——è‰¦åº—</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        :root {
            --primary: #0ea5e9; --dark: #0f172a; --accent: #ef4444; 
            --glass: rgba(255, 255, 255, 0.95);
            --shadow: 0 10px 30px -10px rgba(0,0,0,0.1);
        }
        body { font-family: 'PingFang TC', sans-serif; background: #f1f5f9; margin: 0; overflow-x: hidden; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }

        /* --- 1. æ»¿ç‰ˆå“ç‰Œé¦–é  (Landing) --- */
        #landing {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 5000;
          background: linear-gradient(135deg, #334155 0%, #475569 100%);
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;
            transition: transform 0.8s cubic-bezier(0.7, 0, 0.3, 1);
        }
        #landing.hidden { transform: translateY(-100%); }
        .hero-logo { width: 120px; height: 120px; border-radius: 50%; border: 4px solid white; box-shadow: 0 0 40px rgba(255,255,255,0.2); margin-bottom: 20px; }
        .enter-btn {
            background: var(--accent); color: white; border: none; padding: 16px 45px; border-radius: 50px;
            font-size: 1.3rem; font-weight: 900; letter-spacing: 2px; cursor: pointer;
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.5); transition: 0.3s; margin-top: 30px;
        }
        .enter-btn:active { transform: scale(0.95); }

        /* --- 2. å•†åº—å°è¦½åˆ— (Sticky) --- */
        nav {
            background: var(--glass); backdrop-filter: blur(12px);
            padding: 10px 5%; display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 20px rgba(0,0,0,0.05);
        }
        .nav-brand { display: flex; align-items: center; gap: 10px; font-weight: 900; color: var(--dark); font-size: 1.2rem; }
        .status-badge { font-size: 0.75rem; padding: 4px 12px; border-radius: 20px; font-weight: bold; }

        /* --- 3. åˆ†é¡æ»‘å‹•åˆ— --- */
        .cat-bar {
            background: white; overflow-x: auto; white-space: nowrap; padding: 12px 5%;
            position: sticky; top: 60px; z-index: 999; border-bottom: 1px solid #e2e8f0;
            display: flex; gap: 12px; scrollbar-width: none;
        }
        .cat-bar::-webkit-scrollbar { display: none; }
        .cat-btn {
            padding: 8px 18px; border-radius: 30px; background: #f8fafc; color: #64748b;
            text-decoration: none; font-size: 0.9rem; font-weight: bold; transition: 0.3s; border: 1px solid transparent;
        }
        .cat-btn.active { background: var(--dark); color: white; box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2); }

        /* --- 4. å•†å“å±•ç¤ºå€ --- */
        .shop-container { max-width: 1000px; margin: 0 auto; padding: 20px 5% 120px; }
        .section-header {
            font-size: 1.4rem; font-weight: 900; color: var(--dark); margin: 40px 0 20px;
            display: flex; align-items: center; gap: 10px;
        }
        .section-header::before { content: ''; width: 6px; height: 24px; background: var(--accent); border-radius: 4px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .card {
            background: white; border-radius: 20px; overflow: hidden; position: relative;
            box-shadow: var(--shadow); transition: 0.3s; border: 1px solid white;
        }
        .card img { width: 100%; height: 120px; object-fit: contain; background: #f8fafc; padding: 15px; box-sizing: border-box; }
        .card-body { padding: 12px; text-align: center; }
        .card-title { font-weight: bold; font-size: 0.95rem; margin-bottom: 5px; height: 2.5em; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .card-price { color: var(--accent); font-weight: 900; font-size: 1.1rem; }
        .add-icon-btn {
            position: absolute; bottom: 10px; right: 10px; background: var(--dark); color: white;
            width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            border: none; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); font-size: 1.2rem;
        }

        /* --- 5. æ‹‹ç‰©ç·šå‹•ç•«çƒ --- */
        .fly-dot {
            position: fixed; width: 20px; height: 20px; background: var(--accent); border-radius: 50%;
            z-index: 9999; pointer-events: none; box-shadow: 0 0 10px var(--accent);
        }

        /* --- 6. æ‡¸æµ®è³¼ç‰©è»Š (FAB) --- */
        #cart-fab {
            position: fixed; bottom: 30px; right: 30px; background: var(--accent); color: white;
            width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; cursor: pointer; z-index: 4000; box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
            transition: 0.2s;
        }
        #cart-fab:active { transform: scale(0.9); }
        .cart-badge {
            position: absolute; top: -5px; right: -5px; background: white; color: var(--accent);
            font-size: 0.8rem; font-weight: bold; width: 24px; height: 24px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; border: 2px solid var(--accent);
        }

        /* --- 7. è³¼ç‰©è»Šå´é‚ŠæŠ½å±œ (Side Drawer) --- */
        #cart-drawer {
            position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%;
            background: white; z-index: 6000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: -10px 0 40px rgba(0,0,0,0.1); display: flex; flex-direction: column;
        }
        #cart-drawer.open { right: 0; }
        .drawer-header { padding: 20px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .drawer-body { flex: 1; overflow-y: auto; padding: 20px; }
        .drawer-footer { padding: 20px; border-top: 1px solid #f1f5f9; background: #f8fafc; }

        /* è³¼ç‰©è»Šå…§åˆ—è¡¨ */
        .cart-item { display: flex; justify-content: space-between; margin-bottom: 15px; align-items: center; font-size: 0.95rem; }
        .remove-btn { color: #94a3b8; background: none; border: none; padding: 5px; font-size: 1.2rem; }

        /* è¼¸å…¥æ¡†ç¾åŒ– */
        input, textarea, select { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid #e2e8f0; border-radius: 12px; background: white; box-sizing: border-box; font-size: 1rem; }
        .checkout-btn { width: 100%; background: var(--dark); color: white; padding: 15px; border-radius: 12px; border: none; font-weight: bold; font-size: 1.1rem; }

        /* --- 8. åœ°åœ–å€å¡Š --- */
        .map-box { border-radius: 15px; overflow: hidden; border: 4px solid white; box-shadow: var(--shadow); margin-top: 10px; }
    </style>
</head>
<body>

<div id="landing">
    <img src="logo.png" class="hero-logo animate__animated animate__zoomIn" onerror="this.src='https://ui-avatars.com/api/?name=ç†Šå†°O&background=ef4444&color=fff&size=128'">
    <h1 class="animate__animated animate__fadeInUp">ç†Šå†°O å†·å‡é£Ÿå“</h1>
    <p class="animate__animated animate__fadeIn" style="opacity: 0.9;">ä¸­åŸ”åœ¨åœ°åš´é¸ï¼æ‰¹ç™¼é›¶å”®é¦–é¸</p>
    
    <div style="background: rgba(255,255,255,0.1); backdrop-filter: blur(5px); padding: 15px; border-radius: 15px; margin-top: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">
        <p style="margin: 5px 0;">ğŸ“ å˜‰ç¾©ç¸£ä¸­åŸ”é„‰æ°¸æ¨‚æ–°æ‘248è™Ÿ</p>
        <p style="margin: 5px 0;">â° ç‡Ÿæ¥­æ™‚é–“ï¼š08:00 - 20:00</p>
    </div>

    <button class="enter-btn animate__animated animate__pulse animate__infinite" onclick="enterShop()">é–‹å§‹é¸è³¼ âœ</button>
</div>

<nav>
    <div class="nav-brand">
        <img src="logo.png" style="width:35px; height:35px; border-radius:50%;" onerror="this.style.display='none'">
        <span>ç†Šå†°O</span>
    </div>
    <div id="store-status" class="status-badge">æª¢æŸ¥ä¸­...</div>
</nav>

<div class="cat-bar" id="cat-bar">
    <a href="#cat-pot" class="cat-btn active">ç«é‹æ–™</a>
    <a href="#cat-fry" class="cat-btn">ç¾å‘³ç‚¸ç‰©</a>
    <a href="#cat-meat" class="cat-btn">æµ·é®®è‚‰é¡</a>
    <a href="#cat-main" class="cat-btn">ç²¾é¸éºµé£Ÿ</a>
</div>

<div class="shop-container">
    <div id="cat-pot" class="section-header">ğŸ¢ ç«é‹æ–™ / ç§¤æ–¤å°é»</div>
    <div class="grid" id="grid-pot"></div>

    <div id="cat-fry" class="section-header">ğŸŸ ç†±é–€é»å¿ƒç‚¸ç‰©</div>
    <div class="grid" id="grid-fry"></div>

    <div id="cat-meat" class="section-header">ğŸ¥© æµ·é®®èˆ‡å„å¼è‚‰é¡</div>
    <div class="grid" id="grid-meat"></div>

    <div id="cat-main" class="section-header">ğŸœ ç²¾é¸ä¸»é£Ÿéºµé¡</div>
    <div class="grid" id="grid-main"></div>

    <div style="margin-top: 60px; text-align: center;">
        <h3 style="color: var(--dark);">ğŸ“ æ­¡è¿ä¾†åº—å–è²¨</h3>
        <div class="map-box">
            <iframe src="https://maps.google.com/maps?q=å˜‰ç¾©ç¸£ä¸­åŸ”é„‰æ°¸æ¨‚æ–°æ‘248è™Ÿ&t=&z=15&ie=UTF8&iwloc=&output=embed" width="100%" height="250" style="border:0;" loading="lazy"></iframe>
        </div>
        <a href="https://www.google.com/maps/dir/?api=1&destination=å˜‰ç¾©ç¸£ä¸­åŸ”é„‰æ°¸æ¨‚æ–°æ‘248è™Ÿ" target="_blank" style="display:inline-block; margin-top:15px; color: var(--primary); font-weight: bold; text-decoration: none;">ğŸš€ é–‹å•Ÿ Google å°èˆª</a>
    </div>
</div>

<div id="cart-fab" onclick="toggleDrawer()">
    ğŸ›’
    <div class="cart-badge" id="cart-count">0</div>
</div>

<div id="cart-drawer">
    <div class="drawer-header">
        <h2 style="margin:0; color:var(--dark);">æ‚¨çš„è³¼ç‰©è»Š</h2>
        <button onclick="toggleDrawer()" style="background:none; border:none; font-size:1.5rem;">âœ•</button>
    </div>
    <div class="drawer-body">
        <div id="cart-list"></div>
        <div id="empty-msg" style="text-align:center; color:#94a3b8; margin-top:20px; display:none;">
            é‚„æ²’æœ‰åŠ å…¥ä»»ä½•å•†å“å–”ï¼<br>å¿«å»é¸è³¼å–œæ­¡çš„ç¾é£Ÿå§ ğŸ˜‹
        </div>
    </div>
    <div class="drawer-footer">
        <div style="display:flex; justify-content:space-between; font-weight:900; font-size:1.2rem; margin-bottom:15px; color:var(--accent);">
            <span>ç¸½è¨ˆ</span>
            <span>$<span id="cart-total">0</span></span>
        </div>
        
        <label style="font-size:0.85rem; font-weight:bold; color:#64748b;">ğŸ“… é ç´„å–è²¨æ—¥æœŸ</label>
        <input type="date" id="p-date">
        
        <input type="text" id="p-name" placeholder="è¨‚è³¼äººå§“å">
        <input type="tel" id="p-phone" placeholder="è¯çµ¡é›»è©±">
        <textarea id="p-note" rows="2" placeholder="å‚™è¨» (å¦‚ï¼šéœ€è¦åˆ†è£)"></textarea>
        
        <button class="checkout-btn" onclick="submitOrder()">ç¢ºèªé€å‡ºé ç´„</button>
    </div>
</div>

<script>
    // ä½ çš„ Google Apps Script ç¶²å€
    const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbzfHhadFwFzg5P005DzlftVNpPFg4HqOxfy3p0ajZwEWAWP_XTinFypj-CFHkFBKJ1E/exec";

    // é è¨­å•†å“åº« (å¦‚æœ localStorage æ²’è³‡æ–™å°±ç”¨é€™å€‹)
    const defaultProducts = {
        pot: [ {n:"ç¶œåˆç«é‹æ–™(ç§¤æ–¤)", p:50}, {n:"éº»ç³¬è›‹é»ƒèŠ‹ä¸¸", p:70}, {n:"ç¶œåˆç‡’è³£", p:100}, {n:"ç‰ç±³å¸ƒä¸é…¥", p:50} ],
        fry: [ {n:"æŠ«è–©(ä¸€å€‹)", p:20}, {n:"æª¸æª¬é›æŸ³", p:50}, {n:"åŸå‘³é›ç±³èŠ±", p:50}, {n:"é›å¡Š", p:50}, {n:"èœœç³–å°è‚‰è±†", p:50}, {n:"é»ƒé‡‘è„†è–¯", p:50}, {n:"é¦¬éˆ´è–¯æ¢", p:50}, {n:"æ¸¯å¼è˜¿è””ç³•", p:50} ],
        meat: [ {n:"é¯›é­šç‰‡", p:60}, {n:"æª¸æª¬è´è¶è…¿", p:100}, {n:"ä¹å±¤å¡”é›è…¿æ’", p:100}, {n:"ç„¡éª¨ç‰›å°æ’", p:100}, {n:"é†ƒæ¼¬é›è…¿æ’", p:100}, {n:"é¹¹è±¬è‚‰", p:100}, {n:"é»ƒé‡‘ç¿…åŒ…é£¯", p:100}, {n:"é›è‚‰æ²", p:100} ],
        main: [ {n:"è’¸ç…®éºµ", p:10}, {n:"ç§‘å­¸éºµ(2åŒ…)", p:15}, {n:"é‹ç‡’éºµ(3åŒ…)", p:20}, {n:"æ‰‹å·¥è”¥æŠ“é¤…", p:100}, {n:"çƒé¾éºµ", p:100} ]
    };

    // å„ªå…ˆè®€å– localStorage çš„å•†å“è¨­å®š (è®“ç®¡ç†è€…é é¢ç”Ÿæ•ˆ)
    let db = JSON.parse(localStorage.getItem('bear_products_db')) || defaultProducts;
    let cart = [];
    let isOpen = localStorage.getItem('bear_store_status') !== 'closed';

    // åˆå§‹åŒ–
    window.onload = () => {
        checkStatus();
        renderAll();
        // é å¡«æ—¥æœŸç‚ºæ˜å¤©
        const tmr = new Date(); tmr.setDate(tmr.getDate() + 1);
        document.getElementById('p-date').valueAsDate = tmr;
        document.getElementById('p-date').min = new Date().toISOString().split("T")[0];
    };

    function enterShop() {
        document.getElementById('landing').classList.add('hidden');
        // é–å®šæ»¾å‹•åˆ°é ‚éƒ¨
        window.scrollTo(0,0);
    }

    function checkStatus() {
        const badge = document.getElementById('store-status');
        const btns = document.querySelectorAll('.add-icon-btn');
        if (isOpen) {
            badge.innerText = "ğŸŸ¢ ç‡Ÿæ¥­ä¸­";
            badge.style.background = "#dcfce7"; badge.style.color = "#166534";
        } else {
            badge.innerText = "ğŸ”´ å·²æ‰“çƒŠ (åƒ…ä¾›ç€è¦½)";
            badge.style.background = "#fee2e2"; badge.style.color = "#991b1b";
            // ç¦ç”¨åŠ å…¥è³¼ç‰©è»Š
            btns.forEach(b => b.disabled = true);
        }
    }

    function renderAll() {
        renderSection('pot', 'grid-pot');
        renderSection('fry', 'grid-fry');
        renderSection('meat', 'grid-meat');
        renderSection('main', 'grid-main');
    }

    function renderSection(cat, id) {
        // å®‰å…¨æª¢æŸ¥ï¼šç¢ºä¿ db[cat] å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨çµ¦ç©ºé™£åˆ—
        const items = db[cat] || [];
        document.getElementById(id).innerHTML = items.map(item => `
            <div class="card">
                <img src="logo.png" onerror="this.src='https://ui-avatars.com/api/?name=${item.n}&background=f8fafc&color=0f172a'">
                <div class="card-body">
                    <div class="card-title">${item.n}</div>
                    <div class="card-price">$${item.p}</div>
                </div>
                <button class="add-icon-btn" onclick="addToCart(event, '${item.n}', ${item.p})" ${!isOpen ? 'disabled style="background:#ccc"' : ''}>ï¼‹</button>
            </div>
        `).join('');
    }

    function addToCart(e, n, p) {
        if(!isOpen) return alert("ç›®å‰éç‡Ÿæ¥­æ™‚é–“ï¼Œç„¡æ³•ä¸‹å–®å–”ï¼");

        // 1. éœ‡å‹•å›é¥‹
        if (navigator.vibrate) navigator.vibrate(50);

        // 2. æ‹‹ç‰©ç·šå‹•ç•«
        const fab = document.getElementById('cart-fab').getBoundingClientRect();
        const startX = e.clientX;
        const startY = e.clientY;
        
        const dot = document.createElement('div');
        dot.className = 'fly-dot';
        dot.style.left = startX + 'px';
        dot.style.top = startY + 'px';
        document.body.appendChild(dot);

        // ä½¿ç”¨ Web Animation API è£½ä½œæ›²ç·š
        // æŠ€å·§ï¼šXè»¸ç·šæ€§ç§»å‹•ï¼ŒYè»¸ ease-in (æ¨¡æ“¬é‡åŠ›)
        dot.animate([
            { transform: `translate(0,0) scale(1)` },
            { transform: `translate(${fab.left - startX + 20}px, ${fab.top - startY + 20}px) scale(0.2)` }
        ], { duration: 600, easing: 'cubic-bezier(0.2, 0.8, 0.2, 1)' });

        setTimeout(() => {
            dot.remove();
            // è³¼ç‰©è»Šåœ–ç¤ºæŠ–å‹•
            const cartBtn = document.getElementById('cart-fab');
            cartBtn.style.transform = "scale(1.2)";
            setTimeout(()=> cartBtn.style.transform = "scale(1)", 150);
            
            // 3. å¯¦éš›åŠ å…¥æ•¸æ“š
            cart.push({name: n, price: p});
            updateCartUI();
        }, 550);
    }

    function updateCartUI() {
        document.getElementById('cart-count').innerText = cart.length;
        document.getElementById('cart-total').innerText = cart.reduce((acc, item) => acc + item.price, 0);
        
        const list = document.getElementById('cart-list');
        list.innerHTML = cart.map((item, idx) => `
            <div class="cart-item">
                <span>${item.name}</span>
                <div style="display:flex; align-items:center; gap:10px;">
                    <b>$${item.price}</b>
                    <button class="remove-btn" onclick="cart.splice(${idx},1);updateCartUI()">Ã—</button>
                </div>
            </div>
        `).join('');

        document.getElementById('empty-msg').style.display = cart.length ? 'none' : 'block';
    }

    function toggleDrawer() {
        document.getElementById('cart-drawer').classList.toggle('open');
    }

    async function submitOrder() {
        const name = document.getElementById('p-name').value;
        const phone = document.getElementById('p-phone').value;
        const date = document.getElementById('p-date').value;
        const note = document.getElementById('p-note').value;

        if (!cart.length) return alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„å–”ï¼");
        if (!name || !phone || !date) return alert("è«‹å¡«å¯«å§“åã€é›»è©±èˆ‡å–è²¨æ—¥æœŸ");

        const btn = document.querySelector('.checkout-btn');
        btn.innerText = "â³ è¨‚å–®å‚³é€ä¸­...";
        btn.disabled = true;

        const itemsStr = cart.map(i => i.name).join(',');
        const total = cart.reduce((acc, i) => acc + i.price, 0);
        const finalNote = `å–è²¨:${date} | ${note}`;

        try {
            await fetch(`${GOOGLE_URL}?name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}&items=${encodeURIComponent(itemsStr)}&total=${total}&note=${encodeURIComponent(finalNote)}`, {
                method: 'POST', mode: 'no-cors'
            });
            alert("ğŸ‰ é ç´„æˆåŠŸï¼\næˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„è¨‚å–®ï¼Œè«‹æ–¼é ç´„æ™‚é–“ä¾†åº—å–è²¨ã€‚");
            cart = []; updateCartUI(); toggleDrawer();
        } catch (error) {
            alert("é€£ç·šå¤±æ•—ï¼Œè«‹ç›´æ¥é›»è©±é ç´„ 05-2393005");
        }
        btn.innerText = "ç¢ºèªé€å‡ºé ç´„";
        btn.disabled = false;
    }

    // åˆ†é¡å°è¦½åˆ—æ»¾å‹•ç›£è½ (è®“åˆ†é¡æŒ‰éˆ•è·Ÿè‘—é é¢äº®èµ·ä¾†)
    window.addEventListener('scroll', () => {
        let current = '';
        const sections = ['cat-pot', 'cat-fry', 'cat-meat', 'cat-main'];
        sections.forEach(id => {
            const el = document.getElementById(id); // é€™è£¡æ˜¯æ¨™é¡Œ
            const headerOffset = 150; // åç§»é‡
            if (window.scrollY >= (el.offsetTop - headerOffset)) {
                current = id;
            }
        });
        
        document.querySelectorAll('.cat-btn').forEach(a => {
            a.classList.remove('active');
            if(a.getAttribute('href') === '#' + current) a.classList.add('active');
        });
    });
</script>
</body>
</html>


