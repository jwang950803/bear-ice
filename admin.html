<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç†Šå†°O - åº—é•·ç®¡ç†ç³»çµ±</title>
    <style>
        :root {
            --primary: #0077b6;
            --dark: #1e293b;
            --bg: #f1f5f9;
            --white: #ffffff;
            --accent: #fb8500;
        }

        body {
            font-family: 'PingFang TC', sans-serif;
            background-color: var(--bg);
            margin: 0;
            color: #334155;
        }

        /* å°è¦½åˆ— */
        nav {
            background: var(--dark);
            color: white;
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .container { padding: 30px 5%; max-width: 1200px; margin: 0 auto; }

        /* å€å¡Šå¡ç‰‡ */
        .card {
            background: var(--white);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        h2 { color: var(--primary); margin-top: 0; display: flex; align-items: center; gap: 10px; }

        /* è¡¨å–®è¨­è¨ˆ */
        .input-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        input, textarea {
            padding: 12px;
            border: 1.5px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
        }
        .btn-add {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-add:hover { background: #023e8a; }

        /* è¨‚å–®è¡¨æ ¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 15px; overflow: hidden; }
        th { background: #e2e8f0; color: var(--dark); padding: 15px; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; font-size: 0.95rem; }
        .note-cell { color: #64748b; font-size: 0.85rem; max-width: 250px; }
        .status-tag { background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; }

        /* åº«å­˜ç®¡ç† */
        .product-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .p-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #f8fafc;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        .p-item img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
    </style>
</head>
<body>

<nav>
    <div style="display: flex; align-items: center; gap: 10px;">
        <img src="logo.png" style="width:40px; height:40px; border-radius:50%;" onerror="this.style.display='none'">
        <h1 style="margin:0; font-size: 1.4rem;">ç†Šå†°O åº—é•·å¾Œå°</h1>
    </div>
    <div id="last-update" style="font-size: 0.8rem; opacity: 0.8;">æœ€å¾Œæ›´æ–°: å‰›å‰›</div>
</nav>

<div class="container">
    
    <div class="card">
        <h2>ğŸ“‹ æœ€æ–°è¨‚å–®æŸ¥è©¢</h2>
        <div style="margin-bottom: 15px;">
            <button class="btn-add" onclick="fetchOrders()">ğŸ”„ é‡æ–°æ•´ç†è¨‚å–®</button>
            <span style="margin-left: 10px; color: #64748b; font-size: 0.9rem;">(è³‡æ–™åŒæ­¥è‡ª Google è©¦ç®—è¡¨)</span>
        </div>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>æ™‚é–“</th>
                        <th>é¡§å®¢å§“å</th>
                        <th>é›»è©±</th>
                        <th>è¨‚è³¼é …ç›®</th>
                        <th>é‡‘é¡</th>
                        <th>å–è²¨é ç´„èˆ‡å‚™è¨»</th>
                    </tr>
                </thead>
                <tbody id="order-list">
                    <tr><td colspan="6" style="text-align:center; padding:30px;">é»æ“Šä¸Šæ–¹æŒ‰éˆ•è¼‰å…¥è¨‚å–®...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h2>ğŸš€ å•†å“å¿«é€Ÿä¸Šæ¶</h2>
        <div class="input-group">
            <input type="text" id="p-name" placeholder="å•†å“åç¨± (å¦‚ï¼šæ‰‹å·¥æ°´é¤ƒ)">
            <input type="number" id="p-price" placeholder="åƒ¹æ ¼ (å…ƒ)">
            <input type="text" id="p-img" placeholder="åœ–ç‰‡ç¶²å€ (è²¼ä¸ŠFBæˆ–Imguré€£çµ)">
        </div>
        <textarea id="p-desc" placeholder="å•†å“æè¿° (é¸å¡«ï¼Œæœƒé¡¯ç¤ºåœ¨é¦–é ï¼Œä¾‹å¦‚ï¼šåš´é¸è±¬å¾Œè…¿è‚‰è£½ä½œ...)" rows="2" style="margin-bottom:20px;"></textarea>
        <button class="btn-add" onclick="addProduct()">ç¢ºèªä¸Šæ¶å•†å“</button>
    </div>

    <div class="card">
        <h2>ğŸ“¦ ç›®å‰æ¶ä¸Šå•†å“</h2>
        <div id="inventory" class="product-list"></div>
    </div>

</div>

<script>
    // é€™è£¡è«‹å‹™å¿…è²¼ä¸Šä½ çš„ Google éƒ¨ç½²ç¶²å€ (è·Ÿ index.html ç”¨åŒä¸€å€‹)
    const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbzfHhadFwFzg5P005DzlftVNpPFg4HqOxfy3p0ajZwEWAWP_XTinFypj-CFHkFBKJ1E/exec";

    // å•†å“ç®¡ç†é‚è¼¯
    let products = JSON.parse(localStorage.getItem('bear_p_list')) || [];

    function renderInventory() {
        const container = document.getElementById('inventory');
        container.innerHTML = products.map((p, idx) => `
            <div class="p-item">
                <img src="${p.img}" onerror="this.src='https://via.placeholder.com/60'">
                <div style="flex:1">
                    <div style="font-weight:bold;">${p.name}</div>
                    <div style="color:var(--primary);">$${p.price}</div>
                </div>
                <button onclick="deleteProduct(${idx})" style="color:red; border:none; background:none; cursor:pointer;">åˆªé™¤</button>
            </div>
        `).join('');
        // åŒæ­¥å­˜åˆ° localStorage ä¾›é¡§å®¢ç«¯è®€å–
        localStorage.setItem('bear_p_list', JSON.stringify(products));
    }

    function addProduct() {
        const n = document.getElementById('p-name').value;
        const p = document.getElementById('p-price').value;
        const i = document.getElementById('p-img').value;
        const d = document.getElementById('p-desc').value;

        if(!n || !p) return alert("åç¨±å’Œåƒ¹æ ¼æ˜¯å¿…å¡«çš„å–”ï¼");

        products.push({ name: n, price: parseInt(p), img: i, desc: d });
        renderInventory();
        
        // æ¸…ç©ºè¼¸å…¥æ¡†
        document.getElementById('p-name').value='';
        document.getElementById('p-price').value='';
        document.getElementById('p-img').value='';
        document.getElementById('p-desc').value='';
        alert("å•†å“å·²åŒæ­¥åˆ°é¦–é ï¼");
    }

    function deleteProduct(idx) {
        if(confirm("ç¢ºå®šè¦ä¸‹æ¶é€™é …å•†å“å—ï¼Ÿ")) {
            products.splice(idx, 1);
            renderInventory();
        }
    }

    // è¨‚å–®æŠ“å–é‚è¼¯
    async function fetchOrders() {
        const list = document.getElementById('order-list');
        list.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:30px;">é€£ç·šä¸­ï¼Œè«‹ç¨å€™...</td></tr>';
        
        try {
            // æ³¨æ„ï¼šGAS ç«¯å¿…é ˆæœ‰ doGet è™•ç†è®€å–é‚è¼¯
            const response = await fetch(GOOGLE_URL);
            const data = await response.json();
            
            list.innerHTML = data.map(o => `
                <tr>
                    <td>${o.timestamp || 'ç„¡'}</td>
                    <td><strong>${o.name}</strong></td>
                    <td><a href="tel:${o.phone}">${o.phone}</a></td>
                    <td>${o.items}</td>
                    <td style="color:var(--primary); font-weight:bold;">$${o.total}</td>
                    <td class="note-cell">${o.note || 'ç„¡å‚™è¨»'}</td>
                </tr>
            `).join('');
            document.getElementById('last-update').innerText = "æœ€å¾Œæ›´æ–°: " + new Date().toLocaleTimeString();
        } catch (e) {
            list.innerHTML = '<tr><td colspan="6" style="text-align:center; color:red; padding:30px;">è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª Google è©¦ç®—è¡¨æ¬Šé™å·²é–‹å•Ÿ</td></tr>';
        }
    }

    // åˆå§‹åŒ–
    renderInventory();
</script>

</body>
</html>

