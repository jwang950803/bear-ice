<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç†Šå†°O - åº—é•·ä¸­æ§å°</title>
    <style>
        body { font-family: 'PingFang TC', sans-serif; background: #f1f5f9; padding: 20px; color: #334155; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* å¡ç‰‡é€šç”¨æ¨£å¼ */
        .card { background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); margin-bottom: 24px; border: 1px solid #e2e8f0; }
        h2 { margin-top: 0; color: #0f172a; border-left: 5px solid #ef4444; padding-left: 12px; font-size: 1.5rem; display: flex; align-items: center; justify-content: space-between; }
        
        /* ç‡Ÿæ¥­é–‹é—œ */
        .toggle-btn {
            background: #cbd5e1; color: white; border: none; padding: 8px 20px; border-radius: 50px; 
            font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1rem;
        }
        .toggle-btn.open { background: #22c55e; }
        .toggle-btn.closed { background: #ef4444; }

        /* ä¸Šæ¶è¡¨å–® */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        input, select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; background: #f8fafc; }
        .action-btn { width: 100%; background: #0f172a; color: white; padding: 14px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .action-btn:hover { background: #1e293b; }

        /* --- è¨‚å–®å¡ç‰‡æ¨£å¼ --- */
        .refresh-btn { background: #3b82f6; color: white; border: none; padding: 8px 15px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; }
        .order-card { 
            border-left: 5px solid #3b82f6; background: #fff; margin-bottom: 15px; 
            padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            animation: fadeIn 0.5s ease;
        }
        .order-header { display: flex; justify-content: space-between; color: #64748b; font-size: 0.85rem; margin-bottom: 10px; border-bottom: 1px dashed #e2e8f0; padding-bottom: 8px; }
        .order-main { display: flex; justify-content: space-between; align-items: flex-start; }
        .order-info { flex: 1; }
        .order-name { font-size: 1.2rem; font-weight: 900; color: #0f172a; }
        .order-phone { color: #0ea5e9; font-weight: bold; text-decoration: none; margin-left: 10px; }
        .order-items { margin-top: 8px; font-size: 0.95rem; color: #334155; line-height: 1.5; background: #f1f5f9; padding: 10px; border-radius: 8px; }
        .order-total { font-size: 1.4rem; font-weight: 900; color: #ef4444; text-align: right; min-width: 80px; }
        .order-note { font-size: 0.85rem; color: #d97706; margin-top: 5px; font-weight: bold; }
        .loading { text-align: center; color: #94a3b8; padding: 20px; }

        /* å•†å“åˆ—è¡¨ */
        .p-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f1f5f9; align-items: center; }
        .del-btn { color: #ef4444; background: none; border: none; font-weight: bold; cursor: pointer; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    
    <div class="card">
        <h2>
            <span>ğŸŸ¢ ç‡Ÿæ¥­ç‹€æ…‹</span>
            <button id="status-btn" class="toggle-btn" onclick="toggleStatus()">è®€å–ä¸­...</button>
        </h2>
        <div id="status-text" style="color: #64748b; font-size: 0.9rem;">æ­£åœ¨æª¢æŸ¥é€£ç·š...</div>
    </div>

    <div class="card">
        <h2>
            <span>ğŸ“‹ é¡§å®¢è¨‚å–® (æœ€æ–° 50 ç­†)</span>
            <button class="refresh-btn" onclick="fetchOrders()">ğŸ”„ åˆ·æ–°</button>
        </h2>
        <div id="orders-container">
            <div class="loading">æ­£åœ¨é€£ç·šè‡³é›²ç«¯è³‡æ–™åº«...</div>
        </div>
    </div>

    <div class="card">
        <h2>ğŸ“¦ å•†å“ä¸Šæ¶ç®¡ç†</h2>
        <div class="form-grid">
            <div>
                <label style="font-size:0.8rem; font-weight:bold;">åˆ†å€</label>
                <select id="new-cat">
                    <option value="pot">ğŸ¢ ç«é‹æ–™</option>
                    <option value="fry">ğŸŸ ç‚¸ç‰©</option>
                    <option value="meat">ğŸ¥© è‚‰é¡/æµ·é®®</option>
                    <option value="main">ğŸœ éºµé£Ÿ</option>
                </select>
            </div>
            <div>
                <label style="font-size:0.8rem; font-weight:bold;">åƒ¹æ ¼</label>
                <input type="number" id="new-price" placeholder="ä¾‹å¦‚ï¼š100">
            </div>
        </div>
        <label style="font-size:0.8rem; font-weight:bold;">å•†å“åç¨±</label>
        <input type="text" id="new-name" placeholder="ä¾‹å¦‚ï¼šæ‰‹å·¥å¤§æ°´é¤ƒ">

        <button class="action-btn" onclick="addProduct()">ç¢ºèªä¸Šæ¶</button>

        <div style="margin-top: 20px; border-top: 1px solid #e2e8f0;">
            <p style="font-size:0.9rem; font-weight:bold; color:#64748b; margin-bottom:10px;">ç¾æœ‰æ¶ä¸Šå•†å“ (é»æ“Šä¸‹æ¶)</p>
            <div id="p-list-view"></div>
        </div>
    </div>

</div>

<script>
    // âš ï¸ è«‹ç¢ºèªæ­¤ç¶²å€èˆ‡ index.html è£¡çš„å®Œå…¨ä¸€æ¨£
    const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbzfHhadFwFzg5P005DzlftVNpPFg4HqOxfy3p0ajZwEWAWP_XTinFypj-CFHkFBKJ1E/exec";

    // é è¨­å•†å“ (ç•¶ localStorage ç©ºæ™‚ä½¿ç”¨)
    const defaultData = {
        pot: [ {n:"ç¶œåˆç«é‹æ–™(ç§¤æ–¤)", p:50}, {n:"éº»ç³¬è›‹é»ƒèŠ‹ä¸¸", p:70} ],
        fry: [ {n:"æŠ«è–©(ä¸€å€‹)", p:20}, {n:"æª¸æª¬é›æŸ³", p:50}, {n:"é›å¡Š", p:50} ],
        meat: [ {n:"é¯›é­šç‰‡", p:60}, {n:"é¹¹è±¬è‚‰", p:100} ],
        main: [ {n:"è’¸ç…®éºµ", p:10}, {n:"ç§‘å­¸éºµ(2åŒ…)", p:15} ]
    };

    let db = JSON.parse(localStorage.getItem('bear_products_db')) || defaultData;
    let isOpen = localStorage.getItem('bear_store_status') !== 'closed';

    // åˆå§‹åŒ–
    init();

    function init() {
        renderStatus();
        renderList();
        fetchOrders(); // è‡ªå‹•æŠ“å–è¨‚å–®
    }

    // --- è¨‚å–®è®€å–åŠŸèƒ½ ---
    async function fetchOrders() {
        const container = document.getElementById('orders-container');
        container.innerHTML = '<div class="loading">æ­£åœ¨åŒæ­¥æœ€æ–°è¨‚å–®...</div>';

        try {
            const response = await fetch(GOOGLE_URL);
            const orders = await response.json();

            if (orders.length === 0) {
                container.innerHTML = '<div class="loading">ç›®å‰é‚„æ²’æœ‰è¨‚å–®å–”ï¼</div>';
                return;
            }

            container.innerHTML = orders.map(order => {
                // æ™‚é–“æ ¼å¼åŒ–
                const date = new Date(order.time);
                const timeStr = (date.getMonth()+1) + '/' + date.getDate() + ' ' + 
                                date.getHours().toString().padStart(2,'0') + ':' + 
                                date.getMinutes().toString().padStart(2,'0');

                return `
                <div class="order-card">
                    <div class="order-header">
                        <span>ğŸ•’ ä¸‹å–®æ™‚é–“ï¼š${timeStr}</span>
                    </div>
                    <div class="order-main">
                        <div class="order-info">
                            <div>
                                <span class="order-name">${order.name}</span>
                                <a href="tel:${order.phone}" class="order-phone">ğŸ“ ${order.phone}</a>
                            </div>
                            <div class="order-items">${order.items}</div>
                            ${order.note ? `<div class="order-note">ğŸ“ å‚™è¨»ï¼š${order.note}</div>` : ''}
                        </div>
                        <div class="order-total">$${order.total}</div>
                    </div>
                </div>
                `;
            }).join('');

        } catch (error) {
            container.innerHTML = `<div class="loading" style="color:red;">è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œé‡è©¦ã€‚<br><small>${error}</small></div>`;
        }
    }

    // --- ç‡Ÿæ¥­ç‹€æ…‹æ§åˆ¶ ---
    function renderStatus() {
        const btn = document.getElementById('status-btn');
        const txt = document.getElementById('status-text');
        if (isOpen) {
            btn.innerText = "ç‡Ÿæ¥­ä¸­"; btn.className = "toggle-btn open";
            txt.innerText = "ç›®å‰é¡§å®¢å¯æ­£å¸¸ä¸‹å–®";
        } else {
            btn.innerText = "å·²å…¬ä¼‘"; btn.className = "toggle-btn closed";
            txt.innerText = "ç¶²é å·²é¡¯ç¤ºæ‰“çƒŠï¼Œæš«åœæ¥å–®";
        }
    }

    function toggleStatus() {
        isOpen = !isOpen;
        localStorage.setItem('bear_store_status', isOpen ? 'open' : 'closed');
        renderStatus();
    }

    // --- å•†å“ä¸Šæ¶é‚è¼¯ ---
    function addProduct() {
        const cat = document.getElementById('new-cat').value;
        const name = document.getElementById('new-name').value;
        const price = document.getElementById('new-price').value;

        if (!name || !price) return alert("è«‹è¼¸å…¥åç¨±èˆ‡åƒ¹æ ¼");
        if (!db[cat]) db[cat] = [];

        db[cat].push({ n: name, p: parseInt(price) });
        saveDb();
        
        document.getElementById('new-name').value = '';
        document.getElementById('new-price').value = '';
        renderList();
    }

    function deleteProduct(cat, index) {
        if(confirm("ç¢ºå®šè¦ä¸‹æ¶æ­¤å•†å“å—ï¼Ÿ")) {
            db[cat].splice(index, 1);
            saveDb();
            renderList();
        }
    }

    function saveDb() { localStorage.setItem('bear_products_db', JSON.stringify(db)); }

    function renderList() {
        const container = document.getElementById('p-list-view');
        const catNames = { pot: "ğŸ¢ ç«é‹", fry: "ğŸŸ ç‚¸ç‰©", meat: "ğŸ¥© è‚‰é¡", main: "ğŸœ éºµé£Ÿ" };
        let html = '';
        for (let cat in db) {
            db[cat].forEach((item, index) => {
                html += `
                    <div class="p-item">
                        <div><span style="font-size:0.8rem; background:#e0f2fe; color:#0284c7; padding:2px 6px; border-radius:4px; margin-right:5px;">${catNames[cat]}</span> <b>${item.n}</b> $${item.p}</div>
                        <button class="del-btn" onclick="deleteProduct('${cat}', ${index})">ä¸‹æ¶</button>
                    </div>`;
            });
        }
        container.innerHTML = html;
    }
</script>
</body>
</html>
